set +o xtrace
COW_DIR=$DEST/cow
COW_CONF_DIR=/etc/cow
COW_CONF=$COW_CONF_DIR/cow.conf
COW_BIN_DIR=$COW_DIR/bin

COW_SERVICE_HOST=${COW_SERVICE_HOST:-$SERVICE_HOST}
# Support entry points installation of console scripts
if [[ -d $COW_DIR/bin ]]; then
    COW_BIN_DIR=$COW_DIR/bin
else
    COW_BIN_DIR=$(get_python_exec_prefix)
fi

function init_cow {
    echo_summary "Init Cow"
}

function install_cow {
    echo_summary "Installing Cow"
    setup_develop $COW_DIR
}

function configure_cow {
    echo_summary "Configuring Cow"

    sudo install -d -o $STACK_USER $COW_CONF_DIR

    create_cow_conf_file
}

function create_cow_conf_file {
    echo_summary "Creating Cow conf file"

    rm -f $COW_CONF
    
    iniset $COW_CONF DEFAULT debug "$ENABLE_DEBUG_LOG_LEVEL"
    iniset_rpc_backend COW $COW_CONF

    iniset $COW_CONF api host "$(ipv6_unquote $COW_SERVICE_HOST)"
    iniset $COW_CONF notification driver "messagingv2"
    iniset $COW_CONF notification workers 1
}


function cleanup_cow {
    echo_summary "Cleanup Cow"
}

function stop_cow {
    echo_summary "Stop Cow"
}

function start_cow {
    echo "---------------------------STARTING COW------------------------------"
    run_process cow-ai "$COW_BIN_DIR/cow-ai --config-file $COW_CONF"
    run_process cow-api "$COW_BIN_DIR/cow-api --config-file $COW_CONF"
    run_process cow-agent-notification "$COW_BIN_DIR/cow-agent-notification --config-file $COW_CONF"
}
